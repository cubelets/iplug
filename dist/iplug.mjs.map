{"version":3,"file":"iplug.mjs","sources":["../src/index.js"],"sourcesContent":["export default function iPlug(modules) {\n\tconst pluginModules = new Map(Object.entries(modules || {}))\n\n\treturn {\n\t\tinit: function iPlugInit(requiredPlugins, env) {\n\t\t\tconst hooks = new Map(\n\t\t\t\t([].concat(requiredPlugins || [...pluginModules.keys()])) \n\t\t\t\t// plugins come as a <name>, or a [<name>, [{config}]] structure\n\t\t\t\t.map(plugin => Array.isArray(plugin) ? plugin : [plugin, []])\n\t\t\t\t// for each plugin\n\t\t\t\t.reduce((hooks, [pluginName, config]) => Object\n\t\t\t\t\t// look all hooks up (plugin modules)\n\t\t\t\t\t.entries(pluginModules.get(pluginName) || {[pluginName]: ()=>{throw new Error(`plugin ${pluginName} is missing`)}})\n\t\t\t\t\t// initialise them (they expose a default function for that)\n\t\t\t\t\t.map(([hook, init]) => init && [hook, init({...config, ...env})])\n\t\t\t\t\t// filter out plugins that didn't want to register\n\t\t\t\t\t.filter(x=>x)\n\t\t\t\t\t// and register them for later lookup and use\n\t\t\t\t\t.reduce((hooks, [hook, added]) => (hooks.set(hook, [].concat(hooks.get(hook) || [], added || [])), hooks), hooks)\n\t\t\t\t, new Map())\n\t\t\t)\n\n\t\t\tconst fn = (msg, initialData) => (hooks.get(msg) || [x => x]).reduce((data, plugin) => plugin(data), initialData)\n\t\t\tfn.reduce = fn.chain = fn.series = fn\n\t\t\tfn.map = fn.parallel = fn.all = (msg, initialData) => (hooks.get(msg) || []).map(function callPlugin(plugin){return plugin(initialData)})\n\n\t\t\treturn fn\n\t\t}\n\t}\n}\n\n"],"names":["iPlug","modules","pluginModules","Map","Object","entries","init","requiredPlugins","env","hooks","concat","keys","map","plugin","Array","isArray","reduce","pluginName","config","get","Error","hook","filter","x","added","set","fn","msg","initialData","data","chain","series","parallel","all"],"mappings":"AAAe,SAASA,EAAMC,GAC7B,MAAMC,EAAgB,IAAIC,IAAIC,OAAOC,QAAQJ,GAAW,KAExD,MAAO,CACNK,KAAM,SAAmBC,EAAiBC,GACzC,MAAMC,EAAQ,IAAIN,IAChB,GAAGO,OAAOH,GAAmB,IAAIL,EAAcS,SAE/CC,KAAIC,GAAUC,MAAMC,QAAQF,GAAUA,EAAS,CAACA,EAAQ,MAExDG,QAAO,CAACP,GAAQQ,EAAYC,KAAYd,OAEvCC,QAAQH,EAAciB,IAAIF,IAAe,CAACA,CAACA,GAAa,KAAK,MAAM,IAAIG,MAAM,UAAUH,mBAEvFL,KAAI,EAAES,EAAMf,KAAUA,GAAQ,CAACe,EAAMf,EAAK,IAAIY,KAAWV,OAEzDc,QAAOC,GAAGA,IAEVP,QAAO,CAACP,GAAQY,EAAMG,MAAYf,EAAMgB,IAAIJ,EAAM,GAAGX,OAAOD,EAAMU,IAAIE,IAAS,GAAIG,GAAS,KAAMf,IAAQA,IAC1G,IAAIN,MAGDuB,EAAK,CAACC,EAAKC,KAAiBnB,EAAMU,IAAIQ,IAAQ,CAACJ,GAAKA,IAAIP,QAAO,CAACa,EAAMhB,IAAWA,EAAOgB,IAAOD,GAIrG,OAHAF,EAAGV,OAASU,EAAGI,MAAQJ,EAAGK,OAASL,EACnCA,EAAGd,IAAMc,EAAGM,SAAWN,EAAGO,IAAM,CAACN,EAAKC,KAAiBnB,EAAMU,IAAIQ,IAAQ,IAAIf,KAAI,SAAoBC,GAAQ,OAAOA,EAAOe,MAEpHF"}